# One Market - Planificaci√≥n de Epics

Este documento detalla todos los Epics planificados para One Market, desde fundaciones de datos hasta deployment en producci√≥n.

---

## ‚úÖ Epic 1 ‚Äî Fundaciones de Datos y Almacenamiento

**Status**: COMPLETADO  
**Duraci√≥n estimada**: 2 semanas  
**Completado**: Octubre 2024

### Objetivo
Asegurar ingesti√≥n, almacenamiento y validaciones de OHLCV robustos para m√∫ltiples s√≠mbolos y timeframes.

### Historias

#### ‚úÖ Historia 1.1 ‚Äî Arquitectura de app/data y esquema
- Modelos Pydantic para Bars y metadatos
- Validaciones de consistencia OHLC
- Particionamiento `symbol=X/tf=Y/year=Z/month=M/`
- **Entregables**: `schema.py` con OHLCVBar, DatasetMetadata, StoragePartitionKey

#### ‚úÖ Historia 1.2 ‚Äî Fetch incremental con ccxt
- Cliente ccxt con rate limiting
- Fetch incremental con paginaci√≥n autom√°tica
- Manejo de errores y retry
- Normalizaci√≥n UTC
- **Entregables**: `fetch.py` con DataFetcher, RateLimiter

#### ‚úÖ Historia 1.3 ‚Äî store.py con pyarrow/parquet
- Escritura incremental particionada
- Lectura eficiente con filtros
- Gesti√≥n de metadatos
- Deduplicaci√≥n configurable
- **Entregables**: `store.py` con DataStore

#### ‚úÖ Historia 1.4 ‚Äî Testing y QA de datos
- Tests de validaci√≥n de schema
- Tests de detecci√≥n de gaps
- Tests de storage idempotency
- Fixtures para testing
- **Entregables**: `test_data.py` con 20+ tests

### Criterios de Aceptaci√≥n
- ‚úÖ Fetch de 10k bars en <10s
- ‚úÖ Write/Read de 1k bars en <500ms
- ‚úÖ Detecci√≥n autom√°tica de gaps y duplicados
- ‚úÖ Cobertura de tests >90%
- ‚úÖ Storage particionado por mes
- ‚úÖ Metadata tracking completo

---

## üîÑ Epic 2 ‚Äî Estrategias Cuantitativas

**Status**: PENDIENTE  
**Duraci√≥n estimada**: 3 semanas  
**Inicio previsto**: Noviembre 2024

### Objetivo
Implementar framework de indicadores t√©cnicos, generaci√≥n de se√±ales y backtesting engine para validaci√≥n de estrategias.

### Historias

#### Historia 2.1 ‚Äî Framework de Indicadores T√©cnicos
**Esfuerzo**: 5 d√≠as

Implementar librer√≠a modular de indicadores con interfaz unificada.

**Tareas**:
- Crear clase base `Indicator` con API est√°ndar
- Implementar indicadores b√°sicos:
  - SMA, EMA, WMA (medias m√≥viles)
  - RSI (Relative Strength Index)
  - MACD (Moving Average Convergence Divergence)
  - Bollinger Bands
  - ATR (Average True Range)
- Implementar indicadores avanzados:
  - Ichimoku Cloud
  - Fibonacci retracements
  - Volume Profile
- Testing exhaustivo de c√°lculos vs referencia (TA-Lib)

**Entregables**:
- `app/indicators/base.py`: Clase base Indicator
- `app/indicators/trend.py`: SMA, EMA, MACD
- `app/indicators/momentum.py`: RSI, Stochastic
- `app/indicators/volatility.py`: BB, ATR
- `tests/test_indicators.py`: Tests de precisi√≥n

**Criterios de aceptaci√≥n**:
- Precisi√≥n <0.01% vs TA-Lib para indicadores est√°ndar
- C√°lculo de 1000 per√≠odos en <100ms por indicador
- API consistente: `indicator.calculate(bars) ‚Üí Series`
- Tests con datos conocidos (fixtures)

#### Historia 2.2 ‚Äî Motor de Se√±ales (Entry/Exit)
**Esfuerzo**: 5 d√≠as

Sistema de generaci√≥n de se√±ales basado en condiciones.

**Tareas**:
- Dise√±ar DSL para condiciones de se√±al
- Implementar `SignalGenerator` base
- Crear estrategias ejemplo:
  - SMA Crossover
  - RSI Oversold/Overbought
  - MACD Signal Line Cross
  - Bollinger Band Breakout
- Sistema de filtros (m√∫ltiples timeframes)
- Gesti√≥n de estado de se√±ales

**Entregables**:
- `app/signals/base.py`: SignalGenerator base
- `app/signals/conditions.py`: DSL de condiciones
- `app/signals/strategies/`: Estrategias predefinidas
- `tests/test_signals.py`: Tests de l√≥gica

**Criterios de aceptaci√≥n**:
- Generaci√≥n de se√±al en <1s (target Epic 1)
- Soporte para condiciones compuestas (AND/OR/NOT)
- Tracking de estado: no_position, long, short
- Signals tipados: LONG_ENTRY, LONG_EXIT, SHORT_ENTRY, SHORT_EXIT

#### Historia 2.3 ‚Äî Backtesting Engine
**Esfuerzo**: 8 d√≠as

Motor de backtesting vectorizado con m√©tricas robustas.

**Tareas**:
- Implementar `Backtester` con vectorizaci√≥n
- Sistema de ejecuci√≥n de √≥rdenes simulado
- C√°lculo de m√©tricas:
  - Sharpe Ratio, Sortino Ratio
  - Max Drawdown, Calmar Ratio
  - Win Rate, Profit Factor
  - Expectancy, Average R
- Generaci√≥n de equity curve
- An√°lisis de trades (duraci√≥n, R m√∫ltiples)
- Export de resultados (JSON, CSV)

**Entregables**:
- `app/backtest/engine.py`: Backtester core
- `app/backtest/metrics.py`: C√°lculo de m√©tricas
- `app/backtest/reports.py`: Generaci√≥n de reportes
- `tests/test_backtest.py`: Tests de l√≥gica

**Criterios de aceptaci√≥n**:
- Backtest de 1 a√±o (8760 bars 1h) en <5s
- Precisi√≥n en c√°lculo de P&L (accounting correcto)
- Slippage y comisiones configurables
- Reproducibilidad total (misma seed ‚Üí mismos resultados)
- Export completo de trades

#### Historia 2.4 ‚Äî Optimizaci√≥n de Par√°metros
**Esfuerzo**: 5 d√≠as

Sistema de optimizaci√≥n de par√°metros con grid search y walk-forward.

**Tareas**:
- Implementar grid search
- Walk-forward analysis
- Optimizaci√≥n con objetivos m√∫ltiples (Sharpe, Drawdown)
- Detecci√≥n de overfitting
- Visualizaci√≥n de optimization surface

**Entregables**:
- `app/optimize/grid.py`: Grid search
- `app/optimize/walkforward.py`: Walk-forward
- `app/optimize/objectives.py`: Funciones objetivo
- `tests/test_optimize.py`: Tests

**Criterios de aceptaci√≥n**:
- Grid search de 100 combinaciones en <5min
- Walk-forward con 5 windows
- Detection de curve fitting (validation metrics)
- Export de mejores par√°metros

---

## üìã Epic 3 ‚Äî Gesti√≥n de Riesgo

**Status**: PENDIENTE  
**Duraci√≥n estimada**: 2 semanas  
**Inicio previsto**: Diciembre 2024

### Objetivo
Implementar sistema robusto de gesti√≥n de riesgo con position sizing, SL/TP din√°micos y portfolio management.

### Historias

#### Historia 3.1 ‚Äî Position Sizing
**Esfuerzo**: 3 d√≠as

C√°lculo de tama√±o de posici√≥n basado en riesgo.

**Tareas**:
- Implementar m√©todos de sizing:
  - Fixed fractional (% del capital)
  - Kelly Criterion
  - ATR-based
  - Volatility-adjusted
- C√°lculo de riesgo por trade
- M√°ximo % de capital por trade
- Gesti√≥n de leverage

**Entregables**:
- `app/risk/sizing.py`: Position sizers
- Tests de c√°lculo

**Criterios de aceptaci√≥n**:
- Sizing respeta max risk % configurado
- Ajuste autom√°tico por volatilidad
- C√°lculo de leverage requerido

#### Historia 3.2 ‚Äî Stop Loss / Take Profit Din√°micos
**Esfuerzo**: 4 d√≠as

Sistema de SL/TP adaptativo.

**Tareas**:
- SL fijo (% o ATR)
- Trailing stop
- Time-based stops
- TP por R m√∫ltiple
- Break-even move
- Partial exits

**Entregables**:
- `app/risk/stops.py`: Stop management
- Tests de l√≥gica

**Criterios de aceptaci√≥n**:
- SL/TP se ajustan en tiempo real
- Trailing stop funcional
- Multiple exit levels configurables

#### Historia 3.3 ‚Äî Gesti√≥n de Cartera Multi-S√≠mbolo
**Esfuerzo**: 4 d√≠as

Portfolio management con correlaciones.

**Tareas**:
- Tracking de exposici√≥n total
- L√≠mites por s√≠mbolo/sector
- An√°lisis de correlaciones
- Rebalanceo autom√°tico
- Gesti√≥n de drawdown de cartera

**Entregables**:
- `app/portfolio/manager.py`: Portfolio manager
- `app/portfolio/correlation.py`: An√°lisis
- Tests

**Criterios de aceptaci√≥n**:
- Respeto de l√≠mites de exposici√≥n
- Diversificaci√≥n enforced
- Rebalanceo cuando drift > threshold

#### Historia 3.4 ‚Äî Risk Metrics y Reporting
**Esfuerzo**: 3 d√≠as

Dashboard de m√©tricas de riesgo.

**Tareas**:
- VaR (Value at Risk)
- CVaR (Conditional VaR)
- Risk-adjusted returns
- Stress testing
- Scenario analysis

**Entregables**:
- `app/risk/metrics.py`: C√°lculo de m√©tricas
- `app/risk/reports.py`: Reportes
- Tests

---

## üìã Epic 4 ‚Äî Ejecuci√≥n y Scheduling

**Status**: PENDIENTE  
**Duraci√≥n estimada**: 2 semanas  
**Inicio previsto**: Enero 2025

### Objetivo
Sistema de ejecuci√≥n autom√°tica de trades con order management, position tracking y scheduling robusto.

### Historias

#### Historia 4.1 ‚Äî Order Manager con ccxt
**Esfuerzo**: 5 d√≠as

**Tareas**:
- Order lifecycle: create, submit, monitor, cancel
- Tipos de orden: market, limit, stop-limit
- Retry y error handling
- Order status tracking
- Fill tracking

**Entregables**:
- `app/execution/orders.py`
- Tests con mock exchange

#### Historia 4.2 ‚Äî Position Tracking
**Esfuerzo**: 3 d√≠as

**Tareas**:
- Real-time position updates
- P&L tracking (realized + unrealized)
- Sync con exchange
- Position reconciliation

**Entregables**:
- `app/execution/positions.py`
- Tests

#### Historia 4.3 ‚Äî Scheduler APScheduler
**Esfuerzo**: 4 d√≠as

**Tareas**:
- Job scheduling (daily signals)
- Cron-like syntax
- Error recovery
- Job monitoring
- Notification hooks

**Entregables**:
- `app/scheduler/jobs.py`
- Tests

#### Historia 4.4 ‚Äî Monitoring y Alertas
**Esfuerzo**: 3 d√≠as

**Tareas**:
- Health checks
- Performance monitoring
- Alertas (email, Telegram)
- Logging estructurado

**Entregables**:
- `app/monitoring/`
- Integration con alerting

---

## üìã Epic 5 ‚Äî UI y Visualizaci√≥n

**Status**: PENDIENTE  
**Duraci√≥n estimada**: 3 semanas  
**Inicio previsto**: Febrero 2025

### Objetivo
Dashboard interactivo con Streamlit para control, monitoring y an√°lisis.

### Historias

#### Historia 5.1 ‚Äî Dashboard Principal Streamlit
**Esfuerzo**: 5 d√≠as

**Tareas**:
- Layout responsive
- Sidebar navigation
- Real-time updates
- Theming (dark mode)

**Entregables**:
- `ui/app.py`: Main app
- `ui/pages/`: P√°ginas

#### Historia 5.2 ‚Äî Gr√°ficos Interactivos (Plotly)
**Esfuerzo**: 5 d√≠as

**Tareas**:
- Candlestick charts con indicadores
- Equity curves
- Drawdown charts
- Distribution plots
- Heatmaps de correlaci√≥n

**Entregables**:
- `ui/charts/`: Componentes de gr√°ficos

#### Historia 5.3 ‚Äî Control Panel
**Esfuerzo**: 4 d√≠as

**Tareas**:
- Start/stop strategies
- Config editor
- Manual trade entry
- Position management

**Entregables**:
- `ui/pages/control.py`

#### Historia 5.4 ‚Äî Performance Analytics
**Esfuerzo**: 5 d√≠as

**Tareas**:
- Trade analysis
- Strategy comparison
- Period analysis
- Attribution analysis

**Entregables**:
- `ui/pages/analytics.py`

---

## üìã Epic 6 ‚Äî API y Extensibilidad

**Status**: PENDIENTE  
**Duraci√≥n estimada**: 2 semanas

### Historias
- API REST con FastAPI
- WebSocket para updates real-time
- Documentaci√≥n OpenAPI
- Rate limiting
- Authentication/Authorization

---

## üìã Epic 7 ‚Äî Deployment y DevOps

**Status**: PENDIENTE  
**Duraci√≥n estimada**: 2 semanas

### Historias
- Dockerizaci√≥n
- CI/CD con GitHub Actions
- Deployment scripts
- Monitoring (Prometheus/Grafana)
- Backup autom√°tico

---

## Resumen del Roadmap

```
Timeline (estimada):

Oct 2024  ‚îÇ Epic 1 ‚úÖ
Nov 2024  ‚îÇ Epic 2 üîÑ
Dec 2024  ‚îÇ Epic 3
Jan 2025  ‚îÇ Epic 4
Feb 2025  ‚îÇ Epic 5
Mar 2025  ‚îÇ Epic 6
Apr 2025  ‚îÇ Epic 7
          ‚îÇ
          ‚ñº MVP Production Ready
```

## Prioridades

### Must Have (MVP)
1. ‚úÖ Epic 1: Fundaciones de datos
2. üîÑ Epic 2: Estrategias cuantitativas
3. Epic 3: Gesti√≥n de riesgo
4. Epic 4: Ejecuci√≥n

### Should Have
5. Epic 5: UI y visualizaci√≥n
6. Epic 6: API

### Nice to Have
7. Epic 7: DevOps avanzado

---

**√öltima actualizaci√≥n**: Octubre 2024  
**Epic actual**: Epic 1 (Completado) ‚úÖ  
**Pr√≥ximo epic**: Epic 2 - Estrategias Cuantitativas


